<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Stanza 5</title>

<style>
body{
font-family:Arial;
background:#f4f4f4;
margin:0;
padding:0;
text-align:center;
}

h1{margin-top:30px;}

.grid{
display:grid;
grid-template-columns:1fr 1fr;
gap:20px;
width:90%;
max-width:800px;
margin:30px auto;
}

.dropzone{
background:#ffffff;
border:3px dashed #999;
border-radius:12px;
padding:20px;
min-height:180px;
display:flex;
align-items:center;
justify-content:center;
flex-direction:column;
transition:.3s;
}

.dropzone.correct{
border-color:#28a745;
background:#eaf8ef;
}

.dropzone.wrong{
border-color:#dc3545;
background:#fdeaea;
}

.dropzone img{
width:110px;
height:140px;
object-fit:cover;
border-radius:8px;
margin-bottom:10px;
}

.draggables{
display:flex;
flex-wrap:wrap;
justify-content:center;
gap:15px;
margin:30px;
min-height:60px;
}

.draggable{
background:#1a73e8;
color:white;
padding:12px 16px;
border-radius:10px;
cursor:grab;
max-width:280px;
touch-action:none; /* IMPORTANTISSIMO per mobile */
user-select:none;
}

.drag-preview{
position:fixed;
z-index:9999;
pointer-events:none;
opacity:.95;
background:#1a73e8;
color:white;
padding:12px 16px;
border-radius:10px;
max-width:280px;
}

@media (max-width:768px){
.grid{grid-template-columns:1fr;}
}
</style>
</head>

<body>

<h1>Stanza 5</h1>
<p>Associa ogni citazione al personaggio corretto.</p>

<div class="grid">

<div class="dropzone" data-person="leonardo">
<img src="leonardo.jpg">
<div>Leonardo da Vinci</div>
</div>

<div class="dropzone" data-person="dante">
<img src="dante.jpg">
<div>Dante Alighieri</div>
</div>

<div class="dropzone" data-person="mozart">
<img src="mozart.jpg">
<div>Wolfgang Amadeus Mozart</div>
</div>

<div class="dropzone" data-person="einstein">
<img src="einstein.jpg">
<div>Albert Einstein</div>
</div>

</div>

<div class="draggables" id="draggables">

<div class="draggable" data-match="mozart">
"La musica non è nelle note, ma nel silenzio tra di esse."
</div>

<div class="draggable" data-match="dante">
"Nel mezzo del cammin di nostra vita mi ritrovai per una selva oscura."
</div>

<div class="draggable" data-match="einstein">
"La fantasia è più importante della conoscenza."
</div>

<div class="draggable" data-match="leonardo">
"La semplicità è la massima sofisticazione."
</div>

</div>

<script>
let draggedItem = null;
let preview = null;

let grabOffsetX = 0;
let grabOffsetY = 0;

document.querySelectorAll(".draggable").forEach(item=>{
  item.addEventListener("pointerdown", startDrag);
});

function startDrag(e){

  // blocca lo scroll mobile durante il drag
  e.preventDefault();

  draggedItem = e.currentTarget;

  // calcolo offset reale tra dito e elemento
  const rect = draggedItem.getBoundingClientRect();
  grabOffsetX = e.clientX - rect.left;
  grabOffsetY = e.clientY - rect.top;

  // FORZA SEMPRE RIENTRO NEL CONTENITORE ORIGINALE
  document.getElementById("draggables").appendChild(draggedItem);

  preview = draggedItem.cloneNode(true);
  preview.classList.add("drag-preview");
  document.body.appendChild(preview);

  // posizionamento iniziale corretto
  movePreview(e);

  // cattura il puntatore: evita salti se il dito esce dall'elemento
  draggedItem.setPointerCapture(e.pointerId);

  document.addEventListener("pointermove", movePreview);
  document.addEventListener("pointerup", endDrag);
}

function movePreview(e){
  if(!preview) return;

  preview.style.left = (e.clientX - grabOffsetX) + "px";
  preview.style.top  = (e.clientY - grabOffsetY) + "px";
}

function endDrag(e){

  if(!preview) return;

  let targetZone = null;

  document.querySelectorAll(".dropzone").forEach(zone=>{
    const rect = zone.getBoundingClientRect();

    if(
      e.clientX > rect.left &&
      e.clientX < rect.right &&
      e.clientY > rect.top &&
      e.clientY < rect.bottom
    ){
      targetZone = zone;
    }
  });

  preview.remove();
  preview = null;

  document.removeEventListener("pointermove", movePreview);
  document.removeEventListener("pointerup", endDrag);

  if(!targetZone){
    draggedItem = null;
    return;
  }

  if(targetZone.dataset.person === draggedItem.dataset.match){

    targetZone.appendChild(draggedItem);
    draggedItem.style.pointerEvents="none";
    targetZone.classList.add("correct");

    checkWin();

  }else{

    targetZone.classList.add("wrong");

    setTimeout(()=>{
      targetZone.classList.remove("wrong");
    },700);

  }

  draggedItem = null;
}

function checkWin(){
  let correct = document.querySelectorAll(".dropzone.correct").length;
  if(correct === 4){
    setTimeout(()=>{
      window.location.href="stanza6.html";
    },800);
  }
}
</script>

</body>
</html>
