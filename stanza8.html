<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Stanza 8 - Mise en place</title>

<style>
html, body{
  margin:0;
  height:100%;
  font-family:Arial;
  overflow:hidden;
}

body{
  background:linear-gradient(135deg,#121212,#2b1f14);
  color:#fff;
  display:flex;
  flex-direction:column;
  align-items:center;
}

.header{
  width:100%;
  max-width:980px;
  padding:14px 12px 6px 12px;
  text-align:center;
}

.wrap{
  width:100%;
  max-width:980px;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:12px;
  padding:6px 10px 14px 10px;
}

.table{
  width:min(820px,96vw);
  aspect-ratio:4/3;
  position:relative;
  border-radius:22px;
  background:linear-gradient(135deg,#7a4a26,#3b2412);
  box-shadow:0 18px 45px rgba(0,0,0,.55);
  border:2px solid rgba(255,255,255,.08);
}

/* Target zone */
.target{
  position:absolute;
  border-radius:20px;
  width:110px;
  height:110px;
}

/* Centro */
#t-dinner { top:50%; left:50%; transform:translate(-50%,-50%); }
#t-soup   { top:50%; left:50%; transform:translate(-50%,-50%); }
#t-napkin { top:50%; left:50%; transform:translate(-50%,-50%); }

/* Sinistra (dentro ‚Üí fuori) */
#t-fork-main   { top:50%; left:30%; transform:translate(-50%,-50%); }
#t-fork-second { top:50%; left:18%; transform:translate(-50%,-50%); }

/* Destra */
#t-knife  { top:50%; left:70%; transform:translate(-50%,-50%); }
#t-spoon  { top:50%; left:83%; transform:translate(-50%,-50%); }

/* Bicchieri */
#t-water  { top:25%; left:75%; transform:translate(-50%,-50%); }
#t-wine   { top:22%; left:88%; transform:translate(-50%,-50%); }

/* Dessert sopra orizzontale */
#t-dessert{
  top:20%;
  left:50%;
  transform:translate(-50%,-50%);
  width:140px;
  height:60px;
}

/* Oggetti sul tavolo */
.on-table{
  position:absolute;
  pointer-events:none;
}

.on-table img{
  width:100%;
  height:auto;
  display:block;
}

/* Toolbox */
.toolbox{
  width:min(820px,96vw);
  background:rgba(0,0,0,.25);
  border:1px solid rgba(255,255,255,.14);
  border-radius:18px;
  padding:12px;
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
  gap:12px;
}

.draggable{
  width:64px;
  height:64px;
  border-radius:16px;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:grab;
  background:rgba(255,255,255,.1);
  border:1px solid rgba(255,255,255,.18);
}

.draggable img{
  max-width:80%;
  max-height:80%;
  pointer-events:none;
}

.drag-preview{
  position:fixed;
  z-index:9999;
  width:64px;
  height:64px;
  pointer-events:none;
}

.drag-preview img{ width:100%; }
</style>
</head>

<body>

<div class="header">
  <h1>üçΩÔ∏è Stanza 8</h1>
  <p>Completa la mise en place corretta.</p>
</div>

<div class="wrap">

  <div class="table" id="table">
    <div class="target" id="t-dinner" data-target="plate-dinner"></div>
    <div class="target" id="t-soup" data-target="plate-soup"></div>
    <div class="target" id="t-napkin" data-target="napkin"></div>

    <div class="target" id="t-fork-main" data-target="fork-main"></div>
    <div class="target" id="t-fork-second" data-target="fork-second"></div>

    <div class="target" id="t-knife" data-target="knife"></div>
    <div class="target" id="t-spoon" data-target="spoon"></div>

    <div class="target" id="t-water" data-target="glass-water"></div>
    <div class="target" id="t-wine" data-target="glass-wine"></div>

    <div class="target" id="t-dessert" data-target="spoon-dessert"></div>
  </div>

  <div class="toolbox">
    <div class="draggable" data-item="plate-dinner"><img src="plate-dinner.png"></div>
    <div class="draggable" data-item="plate-soup"><img src="plate-soup.png"></div>
    <div class="draggable" data-item="napkin"><img src="napkin.png"></div>

    <div class="draggable" data-item="fork-main"><img src="fork.png"></div>
    <div class="draggable" data-item="fork-second"><img src="fork.png"></div>

    <div class="draggable" data-item="knife"><img src="knife.png"></div>
    <div class="draggable" data-item="spoon"><img src="spoon.png"></div>

    <div class="draggable" data-item="glass-water"><img src="glass-water.png"></div>
    <div class="draggable" data-item="glass-wine"><img src="glass-wine.png"></div>
    <div class="draggable" data-item="spoon-dessert"><img src="spoon-dessert.png"></div>
  </div>

</div>

<script>
let dragged=null, preview=null;
const table=document.getElementById("table");
const targets=[...document.querySelectorAll(".target")];
let placed={};

document.querySelectorAll(".draggable").forEach(el=>{
  el.addEventListener("pointerdown",startDrag);
});

function startDrag(e){
  dragged=e.currentTarget;
  preview=dragged.cloneNode(true);
  preview.classList.add("drag-preview");
  document.body.appendChild(preview);
  move(e);
  document.addEventListener("pointermove",move);
  document.addEventListener("pointerup",drop);
}

function move(e){
  if(!preview)return;
  preview.style.left=(e.clientX-32)+"px";
  preview.style.top=(e.clientY-32)+"px";
}

function drop(e){
  document.removeEventListener("pointermove",move);
  document.removeEventListener("pointerup",drop);

  let hit=null;
  targets.forEach(t=>{
    const r=t.getBoundingClientRect();
    if(e.clientX>r.left && e.clientX<r.right && e.clientY>r.top && e.clientY<r.bottom){
      hit=t;
    }
  });

  preview.remove();
  preview=null;
  if(!hit)return;

  const item=dragged.dataset.item;
  if(hit.dataset.target!==item)return;

  /* Sequenze obbligatorie */
  if(item==="plate-soup" && !placed["plate-dinner"])return;
  if(item==="napkin" && !placed["plate-soup"])return;

  if(placed[item])return;

  place(item,hit);
  dragged.remove();
  placed[item]=true;

  checkWin();
}

function place(item,target){
  const div=document.createElement("div");
  div.className="on-table";
  const img=document.createElement("img");

  if(item==="fork-main" || item==="fork-second"){
    img.src="fork.png";
  }else{
    img.src=item+".png";
  }

  if(item==="plate-dinner") div.style.width="220px";
  else if(item==="plate-soup") div.style.width="180px";
  else if(item==="napkin") div.style.width="160px";
  else if(item==="spoon-dessert") div.style.width="140px";
  else div.style.width="120px";

  div.appendChild(img);

  const tRect=target.getBoundingClientRect();
  const tableRect=table.getBoundingClientRect();

  div.style.left=(tRect.left-tableRect.left+tRect.width/2)+"px";
  div.style.top=(tRect.top-tableRect.top+tRect.height/2)+"px";
  div.style.transform="translate(-50%,-50%)";

  table.appendChild(div);
}

function checkWin(){
  if(Object.keys(placed).length===10){
    setTimeout(()=>{window.location.href="stanza9.html";},800);
  }
}
</script>

</body>
</html>
